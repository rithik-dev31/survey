{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SurveyLens â€“ Create Account</title>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 25px;
            background: linear-gradient(135deg, #d7eaff 0%, #e9ddff 50%, #ddffe7 100%);
            background-size: 200% 200%;
            animation: gradientMove 10s ease infinite;
        }
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .signup-wrapper {
            width: 430px;
            background: rgba(255, 255, 255, 0.78);
            backdrop-filter: blur(10px);
            padding: 40px 35px;
            border-radius: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.7s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .circle {
            position: absolute;
            border-radius: 50%;
            filter: blur(25px);
            opacity: 0.4;
        }
        .c1 { width: 180px; height: 180px; background: #b5d9ff; top: -40px; right: -40px; }
        .c2 { width: 150px; height: 150px; background: #e3b8ff; bottom: -30px; left: -30px; }
        .c3 { width: 120px; height: 120px; background: #bfffcc; top: 50%; left: -40px; }

        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 15px;
        }
        .logo span {
            font-size: 40px;
            border-radius: 50%;
            padding: 12px;
            background: #ffffffcc;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        h2 {
            text-align: center;
            font-size: 26px;
            font-weight: 700;
            color: #3c3c66;
            margin-bottom: 20px;
        }
        .subtitle {
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
            color: #6f6f8d;
        }

        .field-label {
            font-size: 14px;
            margin-bottom: 5px;
            color: #4c4c66;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            margin-bottom: 18px;
            border: 1px solid #d0d0d0;
            border-radius: 14px;
            outline: none;
            transition: 0.25s;
            background: rgba(255, 255, 255, 0.7);
        }
        input:focus, select:focus {
            border-color: #9a7eff;
            background: #ffffff;
            box-shadow: 0 0 8px rgba(154,126,255,0.3);
        }

        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #8bb7ff, #c8a5ff);
            color: white;
            border: none;
            border-radius: 35px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.25s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(140,120,255,0.3);
        }

        .login-link {
            text-align: center;
            margin-top: 18px;
            font-size: 14px;
            font-weight: 500;
        }
        .login-link a {
            color: #8a63ff;
            font-weight: 600;
            text-decoration: none;
        }

        #errorBox {
            min-height: 20px;
            margin-top: 10px;
            text-align: center;
            font-weight: 600;
        }
    </style>
</head>

<body>

<div class="signup-wrapper">

    <div class="circle c1"></div>
    <div class="circle c2"></div>
    <div class="circle c3"></div>

    <div class="logo"><span>ðŸ“Š</span></div>

    <h2>Join SurveyLens</h2>
    <p class="subtitle">Be part of a smart data-driven future.</p>

    <form id="signupForm" method="POST" action="{% url 'signup' %}">
        {% csrf_token %}

        <label class="field-label">Full Name</label>
        <input type="text" name="name" placeholder="Enter your full name" required>

        <label class="field-label">Username</label>
        <input type="text" name="username" placeholder="Choose a username" required>

        <label class="field-label">Email</label>
        <input type="email" name="email" placeholder="yourname@example.com" required>

        <label class="field-label">Password</label>
        <input type="password" name="password" placeholder="Create a strong password" required>

        <label class="field-label">Occupation</label>
        <input type="text" name="occupation" placeholder="Student, Engineer, etc." required>

        <label class="field-label">Date of Birth</label>
        <input type="date" name="dob" required>

        <label class="field-label">Age</label>
        <input type="number" name="age" placeholder="Your age" required>

        <label class="field-label">Phone Number</label>
        <input type="text" name="phone" placeholder="10-digit mobile" required>

        <label class="field-label">Address</label>
        <input type="text" name="address" placeholder="Your Address" required>

        <label class="field-label">District</label>
        <select name="district" required>
            <option value="">-- Select District --</option>
            {% for code, name in districts %}
            <option value="{{ code }}">{{ name }}</option>
            {% endfor %}
        </select>

        <button type="submit">Create Account</button>
        <div id="errorBox"></div>

    </form>

    <div class="login-link">
        Already have an account?
        <a href="{% url 'signin' %}">Login</a>
    </div>

</div>

<script>
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const form = document.getElementById("signupForm");
const errorBox = document.getElementById("errorBox");

form.addEventListener("submit", function(e) {
    e.preventDefault();

    const csrftoken = getCookie('csrftoken');
    const formData = new FormData(form);

    fetch("{% url 'signup' %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": csrftoken,
            "X-Requested-With": "XMLHttpRequest"
        },
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "error") {
            errorBox.style.color = "red";
            errorBox.textContent = data.message;
        }
        else if (data.status === "success") {
            errorBox.style.color = "green";
            errorBox.textContent = data.message;
            setTimeout(() => {
                window.location.href = data.redirect_url;
            }, 1000);
        }
    })
    .catch(() => {
        errorBox.style.color = "red";
        errorBox.textContent = "Something went wrong!";
    });
});
</script>

</body>
</html>